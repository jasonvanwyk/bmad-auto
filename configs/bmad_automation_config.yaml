# BMad Automation Configuration
# Main configuration file for BMad automation system

# Automation settings
automation:
  # Execution mode: auto, supervised, manual
  mode: supervised

  # Number of stories to process in parallel
  parallel_stories: 3

  # Maximum retry attempts for failed stages
  max_retries: 3

  # Checkpoint after every N stories
  checkpoint_interval: 1

  # Pause between stories (seconds)
  story_delay: 5

  # Enable dry run mode for testing
  dry_run: false

# Tmux session management
tmux:
  # Session name prefix
  session_prefix: bmad-epic

  # Window layout: tiled, even-horizontal, even-vertical, main-horizontal, main-vertical
  window_layout: tiled

  # Keep session alive after completion
  keep_alive: true

  # Auto-attach to session on start
  auto_attach: false

  # Enable logging for all panes
  enable_logging: true

  # Log directory
  log_dir: ~/automation/logs

# Human-in-the-Loop settings
hitl:
  # Enable human intervention
  enabled: true

  # Notification channels (terminal, desktop, sound, slack, email)
  notification_channels:
    - terminal
    - desktop

  # Escalation thresholds
  escalation_thresholds:
    # Agent timeout in seconds
    agent_timeout: 900  # 15 minutes

    # Minimum confidence score (0.0 - 1.0)
    confidence_minimum: 0.7

    # Maximum QA failures before escalation
    qa_failure_max: 2

    # Cost limit in dollars
    cost_limit: 10.0

    # Keywords that trigger escalation
    anomaly_keywords:
      - error
      - failed
      - unclear
      - ambiguous
      - conflict
      - unable
      - cannot

  # Time to wait for human response (seconds)
  decision_timeout: 300  # 5 minutes

  # Auto-suggest solutions based on history
  auto_suggestions: true

  # Learn from human decisions
  learn_from_decisions: true

# BMad agent configuration
agents:
  # Default model for all agents
  default_model: haiku

  # Model overrides per agent
  models:
    sm: haiku
    po: haiku
    dev: sonnet  # More capable for code generation
    qa: haiku
    architect: sonnet
    analyst: haiku

  # Agent timeouts in seconds
  timeouts:
    sm: 600      # 10 minutes
    po: 300      # 5 minutes
    dev: 1800    # 30 minutes
    qa: 900      # 15 minutes
    architect: 1200  # 20 minutes
    analyst: 600     # 10 minutes

  # Temperature settings per agent
  temperatures:
    sm: 0.7
    po: 0.5
    dev: 0.8
    qa: 0.3
    architect: 0.6
    analyst: 0.7

  # Max tokens per agent
  max_tokens:
    sm: 4000
    po: 2000
    dev: 8000
    qa: 4000
    architect: 6000
    analyst: 4000

# Git configuration
git:
  # Use git worktrees for parallel development
  use_worktrees: true

  # Worktree base directory
  worktree_dir: ./stories

  # Auto-commit after successful stages
  auto_commit: true

  # Auto-push to remote
  auto_push: false

  # Create pull requests automatically
  create_prs: true

  # Branch naming pattern
  branch_pattern: "epic-{epic_id}/story-{story_id}"

  # PR template
  pr_template: |
    ## Story: {story_id}

    ### Description
    {story_description}

    ### Changes
    {changes_summary}

    ### Testing
    - [ ] Unit tests pass
    - [ ] Integration tests pass
    - [ ] QA validation complete

    ### Checklist
    - [ ] Code reviewed
    - [ ] Documentation updated
    - [ ] No security issues

    ðŸ¤– Generated by BMad Automation

# Safety settings (VM environment)
safety:
  # Enforce VM environment check
  vm_check: true

  # VM hostname to verify
  vm_hostname: bmad-automation-test

  # Enable command validation
  command_validation: true

  # Enable resource limits
  resource_limits: true

  # Resource limit values
  limits:
    cpu_seconds: 300     # 5 minutes per operation
    memory_mb: 1024      # 1GB memory
    disk_mb: 500         # 500MB disk usage
    processes: 50        # Max processes
    open_files: 100      # Max open files

  # Protected paths (read-only or blocked)
  protected_paths:
    - /etc
    - /boot
    - /sys
    - /proc
    - /root
    - /usr/bin
    - /usr/sbin

  # Blocked command patterns (regex)
  blocked_commands:
    - "rm\\s+-rf\\s+/"
    - ":(\\)\\{:\\|:&\\};:"
    - "curl.*\\|.*sh"
    - "wget.*\\|.*sh"
    - "sudo"
    - "su\\s+"

  # Sandbox directory for safe execution
  sandbox_dir: /tmp/bmad_sandboxes

  # Auto-snapshot before execution
  snapshot_on_start: true

# Monitoring and logging
monitoring:
  # Dashboard refresh rate (seconds)
  dashboard_refresh: 1

  # Log level: DEBUG, INFO, WARNING, ERROR
  log_level: INFO

  # Log format
  log_format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"

  # Log file rotation
  log_rotation:
    max_bytes: 10485760  # 10MB
    backup_count: 5

  # Metrics to track
  metrics:
    - story_completion_time
    - agent_execution_time
    - api_calls
    - token_usage
    - cost_per_story
    - error_rate
    - retry_count

  # Export metrics format
  metrics_export: json  # json, prometheus, csv

  # Alert thresholds
  alerts:
    error_rate_threshold: 0.2      # 20% error rate
    cost_per_story_threshold: 1.0  # $1 per story
    execution_time_threshold: 3600 # 1 hour per story

# External integrations
integrations:
  # Slack notifications
  slack:
    enabled: false
    webhook_url: ""
    channels:
      alerts: "#bmad-alerts"
      progress: "#bmad-progress"

  # Email notifications
  email:
    enabled: false
    smtp_host: ""
    smtp_port: 587
    smtp_user: ""
    smtp_password: ""
    from_address: ""
    to_addresses: []

  # GitHub integration
  github:
    enabled: true
    api_token: ""  # Set via environment variable GITHUB_TOKEN
    org: ""
    repo: ""

  # Custom webhooks
  webhooks:
    - name: "epic_start"
      url: ""
      method: POST
    - name: "epic_complete"
      url: ""
      method: POST
    - name: "story_failed"
      url: ""
      method: POST

# Development settings
development:
  # Enable debug mode
  debug: false

  # Verbose output
  verbose: false

  # Save all agent interactions
  save_interactions: true

  # Interaction directory
  interaction_dir: ~/automation/interactions

  # Enable profiling
  profiling: false

  # Test mode (uses test data)
  test_mode: false

# Project-specific overrides
# These can override any of the above settings
project_overrides:
  # Example project-specific configuration
  # myproject:
  #   automation:
  #     parallel_stories: 5
  #   agents:
  #     models:
  #       dev: opus